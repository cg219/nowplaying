{{template "base" .}}
{{ define "content"}}
<form>
    {{if .SpotifyOn}}
    <fieldset>
        <label for="spotify-session">Scrobble Spotify</label>
        <input type="checkbox" name="spotify-session" role="switch" {{ .SpotifyTrack}}>
    </fieldset>
    {{else}}
    <fieldset>
        <label for="spotify-auth">Allow Spotify Access</label>
        <a target="_self" href="{{.SpotifyAuthURL}}">
            <input type="button" name="spotify-auth" value="Authorize with Spotify" />
        </a>
    </fieldset>
    {{end}}
    {{if not .TwitterOn}}
    <fieldset>
        <label for="x-auth">Allow X Access</label>
        <a target="_self" href="{{.TwitterAuthURL}}">
            <input type="button" name="x-auth" value="Authorize with X">
        </a>
    </fieldset>
    {{end}}
    <fieldset>
        <label for="reset-pass">Reset Password</label>
        <input type="text" name="username" placeholder="Username" />
        <input type="button" name="reset-pass" value="Reset Password"/>
    </fieldset>
</form>
{{end}}

{{define "script"}}
        htmx.onLoad(() => {
            htmx.on('input[name="spotify-session"]', "change", async (evt) => {
                if (evt.target.checked) {
                    await fetch("/api/spotify", {
                        method: "POST"
                    })
                } else {
                    await fetch("/api/spotify", {
                        method: "DELETE"
                    })
                }
                console.log(evt.target.checked)
            })
            htmx.on('input[name="reset-pass"]', "click", async(evt) => {
                const data = new URLSearchParams();
                const username = htmx.find('input[name="username"]').value;

                data.append("username", username)

                await fetch("/api/forgot-password", {
                    headers: {
                        "Content-type": "application/x-www-form-urlencoded"
                    },
                    method: "POST",
                    body: data
                })
            })
        })
{{end}}
